# Дорожная карта QuickEstimate Builder

## Этап 0. Уточнение требований (1–2 недели)
- Интервью с пользователем (ролями подрядчик, инженер, менеджер).
- Перечень источников цен (API, CSV, ручной ввод).
- Решение по облачной инфраструктуре (Supabase/Firebase/Nest).
- Артефакты: утверждённый список требований, user stories, диаграммы потоков.

## Этап 1. Проектирование и дизайн (3 недели)
- Подготовка UX-прототипов в Figma (мобильный viewport iPhone 15).
- Определение дизайн-системы и токенов (см. `docs/design-system.md`).
- Финализация доменной модели, ER-диаграммы, API-контрактов.
- Настройка репозитория, CI, линтеров, тестового фреймворка.
- Критерии готовности: согласованные макеты, спецификация утверждена, CI проходит lint/test.

## Этап 2. Фундамент PWA (3–4 недели)
- Scaffold проекта (Vite + React + TypeScript).
- Реализация сервис-воркера, манифеста, офлайн-оболочки.
- Слой IndexedDB (Dexie), базовые репозитории, Zustand-хранилище.
- Страницы Onboarding, Dashboard (базовые виджеты), Settings.
- Интеграция Storybook, MSW, Playwright (smoke-тесты).
- Критерии готовности: PWA устанавливается, офлайн-режим работает для read-only, unit-тесты > 70% критичных модулей.

## Этап 3. Основной функционал смет (5–6 недель)
- CRUD смет и позиций, иерархический редактор с оптимистичными обновлениями.
- Версионность, история изменений, базовый экспорт PDF (через шаблон).
- Синхронизация с мок-сервером (push/pull), обработка конфликтов.
- Импорт CSV/Excel, шаблоны смет.
- Критерии готовности: тестовые сценарии «Создать → Изменить → Актуализировать → Экспортировать» проходят на устройстве iPhone 15 офлайн/онлайн.

## Этап 4. Модуль ИИ-агентов (4–5 недель)
- Реализация AgentRegistry, FlowEngine, UI-мастера.
- Интеграция с GenKit (использование предоставленных ключей, mock-режим для тестов).
- Первые агенты: актуализация цен, анализ маржинальности.
- Логи запусков, контроль стоимости, уведомления.
- Критерии готовности: два преднастроенных агента работают end-to-end, пользователь может создать кастомного.

## Этап 5. Интеграции и аналитика (4 недели)
- Подключение реальных источников цен (API выбранных поставщиков).
- Расширенные отчёты (XLSX, визуализация трендов, сравнение смет).
- Инструменты совместной работы (комментарии, упоминания, экспорт в облако).
- Критерии готовности: ключевые отчёты доступны, синхронизация стабильно работает на тестовых данных, показатели производительности соответствуют целям (Time-to-interactive < 2.5 сек).

## Этап 6. Стабилизация и релиз (3 недели)
- Оптимизация производительности (bundle splitting, code-splitting, lazy load).
- Регрессия, UX-тесты, аудит доступности, Lighthouse PWA >= 90.
- Документация, руководства, FAQ, подготовка маркетинговых материалов.
- Настройка мониторинга (Sentry, PostHog), аварийные планы.
- Критерии готовности: все критичные баги закрыты, приложение протестировано на iPhone 15 (Safari/Chrome), подготовлена версия для деплоя.

## Риски и смягчающие меры
- **Ограничения iOS PWA**: отсутствие фоновых задач → ручные кнопки синхронизации, напоминания.
- **Зависимость от Gemini**: держать fallback-агента (локальные правила) и кэш последних ответов.
- **Качество данных поставщиков**: валидация, ручное подтверждение, флаг «требует проверки».
- **Сложность UX**: регулярные UX-тесты, аналитика поведения (heatmaps), упрощённый режим для небольших смет.

## Метрики успеха
- Время создания сметы < 10 минут.
- Время актуализации цен < 2 минут (при наличии данных).
- Доля офлайн-сессий без ошибок > 95%.
- Уровень удовлетворенности (опрос) ≥ 4/5.

## Документация и артефакты
- Figma: [ссылка будет добавлена после загрузки макетов].
- Confluence/Notion: база знаний, чек-листы тестов.
- GitHub Projects: дорожная карта с задачами и зависимостями.
