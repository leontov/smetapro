# План реализации QuickEstimate Builder

## 1. Цели релиза v1
- **PWA-опыт на iPhone 15**: установка, офлайн-доступ, мгновенная синхронизация при появлении сети.
- **Полный цикл работы со сметами**: создание, редактирование, копирование, сравнение версий, экспорт отчётов.
- **ИИ-помощь**: предустановленные агенты для актуализации цен и анализа, возможность собирать кастомные флоу.
- **Надёжная локальная база**: IndexedDB с контролем версий, очередью синхронизации, восстановлением после конфликтов.
- **Набор аналитики**: метрики использования и стабильности, контроль стоимости ИИ-запросов.

## 2. Основные этапы и инкременты
| Инкремент | Продолжительность | Основные результаты | Критерии приёмки |
| --- | --- | --- | --- |
| **I0 — Проектирование** | 2 недели | Уточнённые user journey, карта экранов, итоговая архитектурная спецификация (`docs/blueprints/quickestimate-builder.md`), макеты Figma. | Подтверждённая дизайн-система, подписанный план интеграций. |
| **I1 — PWA Foundation** | 3 недели | Стартовый каркас React/Vite, сервис-воркер, манифест, стейт-менеджмент (Zustand + React Query), Storybook, MSW. | Lighthouse PWA ≥ 85, офлайн-чтение списка смет, unit-тесты базовых стор/сервисов. |
| **I2 — Estimate Core** | 5 недель | CRUD смет, иерархия групп и позиций, история, шаблоны, Dexie-репозитории, экспорт PDF. | E2E сценарий «Создать → Изменить → Экспортировать» проходит в Playwright на iPhone 15 viewport. |
| **I3 — Sync & Conflict Resolution** | 4 недели | Очередь syncQueue, ручные и автоматические слияния, экран конфликтов, push/pull с мок-бэкендом. | При переключении offline/online данные остаются консистентными, конфликты разрешаются из UI. |
| **I4 — AI Agents Alpha** | 4 недели | AgentRegistry, FlowEngine, мастера настройки, дефолтные агенты («Price Refresh», «Margin Analyst»), ExecutionLog. | Успешный запуск агентов на демо-смете, логирование и контроль токенов, UX-оценка ≥ 4/5. |
| **I5 — Reports & Insights** | 3 недели | Конструктор отчётов, очередь экспорта (PDF/XLSX), дашборды на visx, отправка в почту/облако. | Сформированные отчёты доступны офлайн, P95 генерации < 15 секунд на тестовых данных. |
| **I6 — Hardening & Release Prep** | 3 недели | Оптимизация bundle, регрессия, доступность (WCAG 2.1 AA), мониторинг (Sentry, PostHog). | Все критичные баги закрыты, Lighthouse ≥ 90/90/90, App Store-like чеклист PWA пройден. |

## 3. Рабочие треки
- **Frontend Core**: архитектура компонентов, офлайн-режим, state management, визуальные компоненты.
- **Data & Sync**: IndexedDB, Dexie слои, адаптеры API, очередь синхронизации, конфликт-менеджер.
- **AI & Insights**: интеграция GenKit, управление агентами, аналитика, отчётность.
- **Experience & QA**: дизайн-система, UX-исследования, accessibility, тестирование на устройствах.
- **DevOps & Tooling**: CI/CD (GitHub Actions), автоматизация тестов, релизные пайплайны, мониторинг.

## 4. Тактичесный бэклог первого цикла (I1)
1. Настроить Vite + React + TypeScript, алиасы FSD-структуры.
2. Включить PWA-плагин, определить стратегии Workbox (см. blueprint §1.5).
3. Реализовать базовые Zustand slices (`auth`, `estimate`, `ui`).
4. Обернуть IndexedDB через Dexie, подготовить миграции v0 → v1.
5. Поднять Storybook + Tailwind токены, собрать библиотеку карточек.
6. Добавить MSW-сервер для локальных API, базовые сценарии e2e (Playwright) и unit-тесты (Vitest).
7. Настроить GitHub Actions: lint, test, build, bundle-size check.
8. Провести UX-проверку на iPhone 15 (Safari/Chrome), задокументировать аномалии.

## 5. Метрики прогресса
- % завершённых user stories в Jira/Linear по трекам.
- Покрытие unit-тестами критичных модулей (`>70%` для I1, `>80%` к I4).
- Среднее время ответа UI при старте (TTI, FCP) на iPhone 15 — измерять через Lighthouse CI.
- Успешные прогоны E2E (`playwright test --project=webkit-iphone`) по основным сценариям.
- Стоимость токенов Gemini в день, отклонение от бюджета ±10%.

## 6. Риски и зависимости
- **Safari PWA ограничения**: нет Push/Background Sync → fallback через локальные напоминания и ручные кнопки синхронизации.
- **Интеграция GenKit**: ожидание ключей и квот → предусмотреть mock-режим и локальное кеширование ответов.
- **Поставщики цен**: разные форматы и лицензии → стандартизированный адаптер, ручные проверки.
- **Производительность Dexie**: виртуализировать списки, батчить транзакции, профилировать на реальных данных.
- **Требования безопасности**: шифрование конфигураций агентов, контроль доступа, аудит логов.

## 7. Коммуникации и артефакты
- **Ритуалы**: еженедельные демо (вт), синхрон по архитектуре (чт), ретро (пт).
- **Документация**: обновлять `docs/` по итогам каждого инкремента, диаграммы в Miro/Figma.
- **Тестовые устройства**: парк iPhone 15/15 Pro, Android Pixel 7 для кросс-проверок.
- **Инструменты**: Linear/Jira для тасков, Notion для знаний, Slack + Loom для асинхронных апдейтов.

## 8. Критерии готовности к пилоту
- Пользователь может установить PWA, пройти онбординг и создать смету без обучения.
- Две предустановленные сметы и два агента готовы и протестированы.
- Экспорт отчётов (PDF, XLSX) доступен офлайн, результаты синхронизируются при подключении.
- Метрики производительности и стабильности находятся в зелёной зоне (Lighthouse ≥ 90, JS heap < 80 МБ).
- Подготовлен план поддержки и SLA для пилотных пользователей.
